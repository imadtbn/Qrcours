<!DOCTYPE html><html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>مسح QR وتحريره</title>
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      background-color: #e6f2ec;
      padding: 20px;
      text-align: center;
      color: #004d26;
    }
    input, button, textarea {
      margin: 10px;
      padding: 10px;
      font-size: 1em;
      border: 1px solid #006633;
      border-radius: 5px;
    }
    button {
      background-color: #00994d;
      color: white;
      cursor: pointer;
      font-size: 0.9em;
      padding: 6px 10px;
      display: inline-block;
    }
    button:hover {
      background-color: #007a3d;
    }
    .button-group {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 6px;
      margin-bottom: 10px;
    }
    #reader {
      margin: auto;
      width: 100%;
      max-width: 400px;
      border: 2px solid #00994d;
      border-radius: 8px;
    }
    #qrcode canvas {
      margin-top: 10px;
      border: 1px solid #00994d;
      padding: 5px;
      background-color: white;
    }
  </style>
</head>
<body>
  <h1>📱 قارئ ومحرر كود QR</h1>
  <p><strong>الأستاذ محمد محمد، أستاذ العلوم الطبيعية</strong></p>  <div id="reader"></div>
  <div class="button-group">
    <button onclick="stopCamera()">🔴 غلق الكاميرا</button>
    <button onclick="startCamera()">📷 فتح الكاميرا</button>
    <button onclick="rescan()">🔄 إعادة المسح</button>
  </div>  <textarea id="scanned-result" rows="5" cols="40" placeholder="نتيجة المسح أو الكود المُحرر..."></textarea>  <br>
  <button onclick="saveCode()">💾 حفظ الكود</button>
  <button onclick="sendCodeByEmail()">📩 إرسال عبر البريد</button>  <h3>🔧 توليد كود QR جديد</h3>
  <form id="qrForm">
    <input type="text" id="name" placeholder="الاسم واللقب" required /><br>
    <input type="text" id="level" placeholder="الطور الدراسي" required /><br>
    <input type="tel" id="phone" placeholder="رقم الهاتف" required /><br>
    <input type="email" id="email" placeholder="البريد الإلكتروني" required /><br>
    <button type="button" onclick="generateQRCode()">🆕 توليد الكود</button>
    <button type="button" onclick="sendGeneratedQRByEmail()">📤 إرسال الكود المولّد عبر البريد</button>
  </form>
  <div id="qrcode"></div>  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>  <script>
    let scanner;
    const resultField = document.getElementById("scanned-result");

    function startCamera() {
      scanner = new Html5Qrcode("reader");
      scanner.start({ facingMode: "environment" }, { fps: 10, qrbox: 250 }, onScanSuccess);
    }

    function stopCamera() {
      if (scanner) {
        scanner.stop().then(() => scanner.clear());
      }
    }

    function rescan() {
      stopCamera();
      setTimeout(startCamera, 500);
    }

    function onScanSuccess(decodedText) {
      resultField.value = decodedText;
      stopCamera();
    }

    function saveCode() {
      const blob = new Blob([resultField.value], { type: "text/plain;charset=utf-8" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "qr_code.txt";
      link.click();
    }

    function generateQRCode() {
      const name = document.getElementById("name").value;
      const level = document.getElementById("level").value;
      const phone = document.getElementById("phone").value;
      const email = document.getElementById("email").value;

      const data = `الاسم: ${name}\nالطور: ${level}\nالهاتف: ${phone}\nالإيميل: ${email}`;
      resultField.value = data;

      const qrcodeContainer = document.getElementById("qrcode");
      qrcodeContainer.innerHTML = "";
      const canvas = document.createElement("canvas");
      qrcodeContainer.appendChild(canvas);

      QRCode.toCanvas(canvas, data, function (error) {
        if (error) {
          alert("حدث خطأ في توليد الكود");
          console.error(error);
        }
      });
    }

    function sendCodeByEmail() {
      const email = document.getElementById("email").value;
      const subject = encodeURIComponent("مشاركة كود QR");
      const body = encodeURIComponent(resultField.value);
      window.location.href = `mailto:${email}?subject=${subject}&body=${body}`;
    }

    function sendGeneratedQRByEmail() {
      const email = document.getElementById("email").value;
      const name = document.getElementById("name").value;
      const subject = encodeURIComponent("الكود الخاص بالطالب: " + name);
      const body = encodeURIComponent(resultField.value);
      window.location.href = `mailto:${email}?subject=${subject}&body=${body}`;
    }
  </script></body>
</html>
